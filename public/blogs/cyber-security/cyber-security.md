# 网络安全

在网络通信的过程中，从攻击者的角度来说，他可以窃听你们传输的数据，也可以修改，插入，删除（后面统称为篡改）传输数据。也可以发起大量的无意义的访问请求，增加服务器负载。
本文将介绍这些问题的解决思路。

针对以上攻击，这要求我们的网络通信要有以下四个特性：机密性、报文完整性、端点鉴别、运行安全性。

让截获者看不懂截获的报文，此时才可以称网络通信具备机密性，但是同时，也要保证通信的双方能够看得懂，否则就失去通信的意义了。加密手段可以分为对称加密和非对称加密。

## 对称性加密

**所有密码算法都涉及用一种东西替换另一种东西的思想。**

发送者用密钥对报文进行加密，只有通过这个密钥才能解密，所以截获者没有密钥，就看不懂这个报文 **（有时也看得懂，这取决于你的加密算法和截获者的破译能力）。**

但是发送者需要把密钥告诉接收者，否则他也看不懂。通过互联网把密钥发送给接收者吗？那密钥就有了被截获的风险，所以**密钥的分发是对称加密里的一个必须解决的问题。**
后面的内容会解决这个问题。

对称加密又有两种宽泛的类型，流密码和块密码，流密码多用于无线网络。我们先主要了解以下块密码。

**它将明文分成多个等长的模块（block），使用确定的算法和对称密钥对每组分别加密解密。** 流行的块密码实现包括DES，3DES，AES。

DES容易被暴力破解（一个一个的尝试密钥），在现在来说已经不够安全了，3DES是使用了3个KEY，进行三轮DES加密，目前还没人宣称能够破译。
AES是用来替代DES的，如果1秒能够暴力破解DES的计算机，破译AES需要149万亿年，并且AES比3DES加解密的速度更快，所以推荐使用AES来进行对称加密。

## 非对称性加密

非对称加密中有两个密钥，公钥和私钥。接收者会公开自己的公钥，发送者用这个公钥对报文进行加密，但是只有公钥无法解密，必须拥有私钥才能解密。**私钥不需要传输给别人，
所以不存在截获风险。**

**这个过程存在一个风险就是发送者怎么安全的获得接收者的公钥？如果公钥被攻击者替换了，那么攻击者可以用自己的私钥进行解密。（TLS中，CA机构解决了这个问题）**

**还有一个注意点是，不能通不过公钥推导出私钥，至少短时间内不可以，如果需要几万年才能推导出，那也可以认为是安全的。**

**最后一个重要的特性是，先用公钥加密，再用私钥解密得到明文m，先用私钥加密，再用公钥解密，同样能得到明文m，这一特性能够用于端到端的鉴别。**

最著名的非对称加密算法是RSA。它满足上面讲到的所有特性，同时非对称加密还有一个无法避免的缺点，**它的加解密算法比对称加密要慢100-10000倍**

# 端点鉴别

通信双方要能确认对方的身份，不是伪造的。

**首先说利用对称加密进行鉴别。** 假设发送者和接收者有一个对称密钥，其他人没有（这里同样也存在密钥分发的问题）。接收者发一个不会重复的随机数给发送者，发送者用密钥对这个数进行加密，接收者对密文解密，如果成功解密说明一定是用
相同的密钥进行加密的，那么这个密钥只有发送者有。

**用非对称加密进行鉴别。** 发送者用自己的私钥进行加密，接收者拥有发送者的公钥，接收者能成功用公钥解密，证明数据一定是经过成对的私钥加密的，那么私钥只有发送者才有。**（CA就用这种方式做端点鉴别）**

## 密钥的分发

**为了满足机密性和端到端的鉴别。采用对称加密必须能安全的分发密钥，采用非对称加密，必须安全的拿到发送者的公钥。**

<div align="center">

<img src="/blogs/cyber-security/KDC.png" height="50%" width="50%"></img>

</div>
解决对称加密密钥分发需要双方信赖第三方机构，密钥分发中心(Key Distribution Center,KDC)。双方需要先和KDC采取线下的方式签署对称密钥，这意味着可以和KDC安全通信了。
想要通信的双方借助着与KDC的安全通信，获得密钥R1，这个密钥只有这双方和KDC知道，之后双方就可以使用密钥R1安全通信了。

非对称加密需要一个认证中心CA，发送者需要通过**带外的方式拿到CA的公钥**，接收者会公开自己的证书（证书是经过CA私钥加密的接收者的公钥和个人信息），发送者通过CA的公钥
解密证书后，得到发送者的公钥。

# 报文完整性

接收者收到的报文必须是没有被攻击者进行过任何篡改的。

实际上在上面提到的非对称加密的过程中，就已经能识别报文是否被修改了，因为修改了就无法正确解密了。问题是报文太大的时候，加密解密耗时过高。
所以散列算法被运用在了这里。

**散列算法SHA-1，对一个报文进行散列运算，能够快速得到一个摘要，但是反向运算从摘要得到报文就非常困难。** 所以我们可以只对摘要进行上述加密。接收者对摘要进行解密，
对报文进行散列，如果得到相同的内容，则证明报文没有被修改过。

# 运行安全性

拒绝不正常的用户访问，进而保证服务的可用性。攻击者能够试图在网络主机中安放蠕虫，获取公司秘密。或者发起DoS攻击消耗服务器资源。

一般我们可以通过防火墙，一套建立在内网与公网中间的软硬件的结合体。防火墙会针对网络包的网络层头部，传输层头部进行检测，把不正常的流量拒绝掉。但是他不检测报文的body部分。
还有一种入侵检测系统，它能够进行更深度的检测。这两种防御措施都有着很复杂的规则，在此就不展开了。本文意在从理论方面，梳理出一个网络安全全面思考的思路。

# 总结

- 对于数据报本身，要做到不能让截获者看得懂，并且不能修改，可以用对称加密和非对称加密和散列算法实现。
- 对于双方的身份，必须要确认是真实的。对称加密中需要KDC这个机构介入。非对称加密中需要CA这个机构介入。
- 对于恶意流量，通常交给防火墙和入侵检测系统处理。
