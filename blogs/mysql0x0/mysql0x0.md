# mysql 全貌介绍

跟着丁奇学了几个月mysql，收获了很多实用的知识，在此结合我工作中的一些实践，分多篇文章做一下总结。

<div align="center">
<img src="/blogs/mysql0x0/mysql.JPG" height="40%" width="40%"></img>

> 结课留念&&推荐订阅

</div>

要学习mysql首先要了解一下它的大致的结构，和每一部分的主要功能。

# mysql的逻辑结构

<div align="center">
<img src="/blogs/mysql0x0/mysql-arch.png" height="40%" width="40%"></img>

> mysql的逻辑架构图

</div>

大体来说，MySQL 可以分为 Server 层和存储引擎层两部分。

Server 层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。

而存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始成为了默认存储引擎。

**不同的存储引擎共用一个 Server 层。**

## 连接器

处理客户端的TCP连接，并且身份认证。

**一个用户成功建立连接后，即使你用管理员账号对这个用户的权限做了修改，也不会影响已经存在连接的权限。修改完成后，只有再新建的连接才会使用新的权限设置。**

**MySQL 在执行过程中临时使用的内存是管理在连接对象里面的，断开连接才能释放这些内存**

## 查询缓存

MySQL 拿到一个查询请求后，会先到查询缓存看看，之前是不是执行过这条语句。之前执行过的语句及其结果可能会以 key-value 对的形式，被直接缓存在内存中。

**只有在写操作远少于读操作的情景下，才建议使用。MySQL 8.0 版本直接将查询缓存的整块功能删掉了。**

## 分析器

识别你的sql是要做什么。如果你的语句不对，就会收到“You have an error in your SQL syntax”的错误提醒。

## 优化器

优化器是在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联（join）的时候，决定各个表的连接顺序。

为什么此时还要判断权限？
**有些时候，SQL语句要操作的表不只是SQL字面上那些。比如如果有个触发器，得在执行器阶段（过程中）才能确定。优化器阶段前是无能为力的。**

## 执行器

先判断有没有执行权限，有权限就调用存储引擎接口执行。

# 存储引擎

| 引擎      | 特点                                                         |
| --------- | ------------------------------------------------------------ |
| ARCHIVE   | 用于数据存档的引擎，数据被插入后就不能在修改了，且不支持索引 |
| CSV       | 在存储数据时，会以逗号作为数据项之间的分隔符                 |
| BLACKHOLE | 会丢弃写操作，该操作会返回空内容                             |
| FEDERATED | 将数据存储在远程数据库中，用来访问远程表的存储引擎           |
| InnoDB    | 具备外键支持功能的事务处理引擎                               |
| MEMORY    | 置于内存的表                                                 |
| MERGE     | 用来管理由多个 MyISAM 表构成的表集合                         |
| MyISAM    | 主要的非事务处理存储引擎                                     |
| NDB       | MySQL 集群专用存储引擎                                       |

第一篇简单介绍一下MYSQL全貌，后续文章将基于InnoDB这种引擎进行详细介绍。
